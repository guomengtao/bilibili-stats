# 更新日志

## [1.2.0] - 2024-03-19

### 改进
- 添加视频标题显示
- 更新选择器以匹配最新的B站页面结构
- 添加调试日志
- 改进错误处理

### 具体更改
- 更新选择器：
  - 播放量: .view-text
  - 点赞数: .like-text
  - 投币数: .coin-text
  - 收藏数: .collect-text
  - 评论数: .reply-header .reply-notice
  - 标题: h1.video-title

## [1.1.0] - 2024-03-19

### 改进
- 更新选择器以适应B站最新的页面结构
- 添加页面变化监听机制
- 改进数据获取的可靠性
- 添加非视频页面的友好提示

### 具体更改

#### content.js
- 更新DOM选择器:
  ```javascript
  play: document.querySelector('.video-info-detail-list .view-count')
  like: document.querySelector('.video-toolbar-left .like')
  coin: document.querySelector('.video-toolbar-left .coin')
  favorite: document.querySelector('.video-toolbar-left .collect')
  comment: document.querySelector('.reply-header .reply-notice')
  ```
- 添加错误处理机制
- 添加MutationObserver监听页面动态变化
- 优化数据获取逻辑

#### popup.js
- 添加非视频页的提示信息
- 改进数据显示逻辑
- 优化错误处理

#### manifest.json
- 简化图标配置，统一使用48x48尺寸
- 更新权限配置

## [1.0.0] - 2024-03-19

### 初始功能
- 基础数据统计功能：
  - 播放量
  - 点赞数
  - 投币数
  - 收藏数
  - 评论数
- 创建基础文件结构：
  - manifest.json: 扩展配置文件
  - content.js: 内容脚本
  - popup.html: 弹出窗口界面
  - popup.js: 弹出窗口逻辑
  - icon48.png: 扩展图标

### 技术说明
- 使用Chrome Extension Manifest V3
- 采用content script方式获取页面数据
- 使用消息传递机制在content script和popup间通信

### 安装说明
1. 打开Chrome扩展管理页面 (chrome://extensions/)
2. 开启开发者模式
3. 点击"加载已解压的扩展程序"
4. 选择包含所有扩展文件的文件夹

### 使用说明
1. 访问任意B站视频页面
2. 点击工具栏中的扩展图标
3. 查看视频相关数据统计

### 注意事项
- 仅在B站视频页面生效
- 需要等待页面完全加载
- 如遇数据未显示，可刷新页面重试 

## [1.2.1] - 2024-03-19

### 改进
- 更新DOM选择器以准确匹配B站最新的页面结构
- 添加详细的调试日志
- 优化MutationObserver的观察策略

### 具体更改
- 更新选择器：
  - 点赞数: .video-like-info
  - 投币数: .video-coin-info
  - 收藏数: .video-fav-info
  - 评论数: .total-reply
- 添加选择器查找结果的调试日志
- 优化MutationObserver的配置

## [1.2.2] - 2024-03-19

### 改进
- 更新选择器以准确匹配B站最新的页面结构
- 添加更详细的调试日志输出

### 具体更改
- 更新选择器：
  - 标题: h1.video-title
  - 播放量: .view-text
  - 点赞数: .video-like-info
  - 投币数: .video-coin-info
  - 收藏数: .video-fav-info
  - 评论数: .reply-notice

## [1.3.0] - 2024-03-19

### 改进
- 添加视频播放/暂停控制按钮
- 更新评论数获取选择器
- 优化popup界面布局
- 默认显示所有数据，无需滑动查看

### 具体更改
- popup.html:
  - 添加播放/暂停控制按钮
  - 优化界面样式
  - 移除滑动查看功能
- content.js:
  - 更新评论数选择器为 #comment #count
  - 添加视频播放控制功能
- popup.js:
  - 添加播放/暂停按钮事件处理

## [1.3.1] - 2024-03-19

### 改进
- 修复评论数获取失败的问题
- 添加点赞按钮功能
- 优化按钮样式，添加图标

### 具体更改
- content.js:
  - 优化评论数选择器和数据提取逻辑
  - 添加点赞功能
- popup.html:
  - 添加点赞按钮
  - 为按钮添加SVG图标
  - 优化按钮样式
- popup.js:
  - 添加点赞按钮事件处理

## [1.3.2] - 2024-03-19

### 改进
- 修复数据不能立即显示的问题
- 优化数据获取逻辑
- 添加超时处理

### 具体更改
- content.js:
  - 添加立即执行数据获取
  - 添加DOMContentLoaded事件监听
  - 添加5秒超时处理
- popup.js:
  - 添加立即执行数据获取
  - 添加DOMContentLoaded事件监听
- manifest.json:
  - 设置content_scripts在document_end时运行

## [1.3.3] - 2024-03-19

### 改进
- 移除评论数统计功能
- 简化数据获取逻辑
- 优化界面布局

### 具体更改
- content.js:
  - 移除评论数相关代码
  - 优化数据获取逻辑
- popup.html:
  - 移除评论数显示部分
  - 调整界面布局

## [1.3.4] - 2024-03-19

### 改进
- 修复评论数获取问题
- 使用B站API直接获取评论数
- 添加必要的权限

### 具体更改
- content.js:
  - 添加API方式获取评论数
  - 优化数据获取逻辑
- manifest.json:
  - 添加host_permissions权限
  - 添加API访问所需的权限

### 技术说明
评论数获取失败的原因：
1. 评论区是动态加载的，初始HTML中不包含评论数据
2. 评论数据需要通过API异步获取
3. 需要额外的API访问权限

解决方案：
1. 直接使用B站API获取评论数
2. 添加必要的跨域访问权限
3. 优化数据获取和更新逻辑

## [1.3.5] - 2024-03-19

### 改进
- 修复插件默认不显示数据的问题
- 添加数据缓存机制
- 优化数据获取和更新逻辑

### 具体更改
- content.js:
  - 添加数据缓存
  - 优化数据获取时机
  - 添加定期更新机制
- popup.js:
  - 添加数据缓存
  - 优化数据请求逻辑
  - 添加定期刷新机制

### 技术说明
数据不显示的原因：
1. 数据获取时机不对
2. 消息传递机制不完善
3. 缺少数据缓存机制

解决方案：
1. 多个时机触发数据获取
2. 添加数据缓存
3. 实现定期更新
4. 优化消息传递机制

## [1.3.6] - 2024-03-19

### 改进
- 修改插件为默认展开显示数据
- 优化界面视觉设计
- 改进数据展示布局

### 具体更改
- popup.html:
  - 移除显示/隐藏控制代码
  - 添加默认显示样式
  - 优化数据展示布局
  - 改进视觉设计

## [1.3.7] - 2024-03-19

### 改进
- 移除无效的面板默认显示代码
- 简化数据获取逻辑
- 保留核心功能

### 具体更改
- content.js:
  - 移除面板控制相关代码
  - 简化数据获取逻辑
- popup.html:
  - 移除面板控制相关样式
  - 保留基本数据展示功能

### 技术说明
由于B站视频页面的数据面板是由B站自己控制的，我们的插件无法控制其默认展开状态。
因此移除了相关的无效代码，专注于数据获取和展示功能。

# 开发对话记录

## 2024-03-19

### 对话 1: 初始开发
Q: 做一个chrome浏览器插件，B站数据统计，当我打开某个视频页面，统计 播放，点赞，投币，收藏和评论总条数，展示出来这些结果。
A: [创建了基础项目结构和文件]
- 创建manifest.json
- 创建content.js
- 创建popup.html
- 创建popup.js
- 设计icon.svg

### 对话 2: 图标问题修复
Q: 图标加载失败问题
A: 提供了base64编码的PNG图标解决方案

### 对话 3: 数据获取问题
Q: 播放量和点赞等数据没有显示
A: 更新了content.js和popup.js的选择器和数据获取逻辑

### 对话 4: 更新记录
Q: 把这些改进记录，存入到一个合适的文件里一一记录起来，方便以后查看。
A: 创建了CHANGELOG.md文件，记录了：
- 版本更新历史
- 具体改进内容
- 代码变更细节
- 安装和使用说明
- 注意事项

### 对话 5: 对话记录
Q: 以后我和你的每次对这个项目的对话都帮我存进去。
A: 在CHANGELOG.md中添加了"开发对话记录"部分，记录所有开发过程中的问题和解决方案。

### 对话 6: 数据获取问题修复
Q: 加入视频标题，数据仍然没有呢，播放量的html代码大概这样的`<div class="view-text" data-v-aed3e268="">6.3万</div>`
A: 更新了选择器以匹配新的页面结构，添加了视频标题显示，并加入了调试日志功能。

### 对话 7: 选择器优化
Q: 播放量出来了，其他没有出来数据，你是否能准确拿到其他数据的选择器
A: 更新了选择器以匹配B站当前的DOM结构，添加了详细的调试日志，优化了页面变化监听机制。

### 对话 8: 选择器更新
Q: 播放量出来了，其他没有出来数据，你是否能准确拿到其他数据的选择器
A: 根据提供的HTML代码，更新了选择器以准确匹配B站当前的页面结构，并添加了详细的调试日志输出。

### 对话 9: 功能增强
Q: 增加默认显示插件的数据出来，不是需要滑动点开。另外增加播放和暂定视频的按钮。另外评论总数的html是这样的结构。
A: 更新了插件界面和功能：
1. 移除了滑动查看的设计，默认显示所有数据
2. 添加了播放/暂停视频的控制按钮
3. 更新了评论数的选择器以匹配新的HTML结构

### 对话 10: 功能完善
Q: 评论总数仍然获取失败。增加一个点赞按钮
A: 更新了评论数获取逻辑，添加了点赞功能：
1. 优化了评论数选择器和数据提取方式
2. 添加了点赞按钮及其功能
3. 优化了按钮样式，添加了图标

### 对话 11: 修复数据显示
Q: 默认显示统计数据也没有成功
A: 更新了数据获取和显示逻辑：
1. 添加了立即执行的数据获取
2. 添加了页面加载完成后的数据获取
3. 优化了数据获取的时机
4. 添加了超时处理机制

### 对话 12: 移除评论数功能
Q: 评论总数始终出不来，核实一下如果不能出来，就删除这一条功能。
A: 由于评论数统计功能无法稳定获取数据，已将其移除：
1. 从content.js中移除评论数获取逻辑
2. 从popup.html中移除评论数显示
3. 优化了剩余功能的展示

### 对话 13: 评论数获取问题分析
Q: 为什么评论总数的数据拿不到呢
A: 分析了评论数据获取失败的原因，并提供了解决方案：
1. 评论区是动态加载的，需要使用API获取
2. 更新了权限配置和数据获取逻辑
3. 添加了错误处理和日志

### 对话 14: 默认显示优化
Q: 注意我的意思是，需要插件数据默认打开，不是鼠标再次点开图表才出来表格
A: 修改了插件设计，使数据面板默认展开显示：
1. 移除了显示/隐藏的控制代码
2. 优化了数据展示布局
3. 改进了整体视觉设计

### 对话 15: 移除无效功能
Q: 面板默认显示似乎是不能实现的。你核实一下，是否删除相关这个功能的代码
A: 确认了面板默认显示功能无法实现，因为这是B站自己控制的。已移除相关无效代码，
保留了核心的数据获取和展示功能。